<!DOCTYPE html>
<html>
<head>
  <title>Electronic Bulletin Board</title>
  <script type="module" src="/client.js"></script>
</head>
<body>
  <header>
    <h1>U-tonomy</h1>
    <% if (user.id) { %>
      <a href="/user"><img src="<%= user.photos[0].value %>"><%= user.displayName %></a>
      <a href="/logout">Logout</a>
    <% } else { %>
        <a href="/auth/google">Login with Google</a>
    <% } %>
  </header>

    <h2>Posts</h2>

    <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º -->
    <% if (error) { %>id INTEGER PRIMARY KEY AUTOINCREMENT,
        <div style="color: red;"><%= error %></div>
    <% } %>

    <ul>
      <% (data.posts || []).forEach(post => { %>
        <li>
          <strong><%= post.user_id %></strong>: <%= post.content %> - <%= post.timestamp %>
          <form action="/post/<%= post.id %>/vote" method="post" style="display:inline;">
            <button type="submit" name="content" value="up" <% if(!post.isVotable){ %>disabled<% } %>>ğŸ‘ (<%= post.votes.up %>)</button>
            <button type="submit" name="content" value="down" <% if(!post.isVotable){ %>disabled<% } %>>ğŸ‘ (<%= post.votes.down %>)</button>
          </form>
        </li>
      <% }) %>
    </ul>
        <form id="post" action="/post" method="post">
          <textarea name="content" placeholder="Write your post here..." required></textarea>
          <label for="viewer">é–²è¦§</label>
          <select name="viewer">
            <option value="all">å…¨æ§‹æˆå“¡</option>
            <option value="world">å…¨ä¸–ç•Œ</option>
            <% (data.permissions || []).forEach(permission => { %>
              <option value="<%= permission.target %>"><%= permission.group.name %>(<%= permission.target %>)</option>
            <% }) %>
          </select>
          <label for="voteType">æŠ•ç¥¨</label>
          <select name="voteType">
            <option value="none">ç„¡åŠ¹</option>
            <option value="up/down">ğŸ‘/ğŸ‘</option>
          </select>
          <select name="voter" hidden>
            <option value="all">å…¨æ§‹æˆå“¡</option>
            <% (data.permissions || []).forEach(permission => { %>
              <option value="<%= permission.target %>"><%= permission.group.name %>(<%= permission.target %>)</option>
            <% }) %>
          </select>
          <button type="submit">Post</button>
        </form>
            
    <div>
      <button type="button" id="newGroup">+</button>
      <form id="newGroupConfig" method="post" action="/group" hidden>
        <label>ã‚°ãƒ«ãƒ¼ãƒ—å<input name="name" required></label>
        <button>
          ä½œæˆ
        </button>
      </form>
    </div>

</body>
</html>
